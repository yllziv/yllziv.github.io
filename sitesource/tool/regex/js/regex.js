$(function(){function e(){n(),r(u.workMode.match),s.val("([^?&=]+)=([^?&=]*)"),h.setValue("https://www.google.com.hk/search?q=CodeMirror&aqs=chrome&sourceid=chrome&es_sm=91&ie=UTF-8"),f.val('"$1":"$2",\r\n'),t()}function n(){s.add(d).add(f).bind("change input",function(e){t(),c()}),$("#btnRun").click(function(e){t()}),$("input[name='workMode']").change(function(e){r($("input[name='workMode']:checked").val()),t()}),$("input[name='replaceMode']").change(function(e){m=Number($("input[name='replaceMode']:checked").val()),t()}),$("input[name='newLineChar']").change(function(e){v=Number($("input[name='newLineChar']:checked").val()),t()}),$("input[name='RegExpOption']").change(function(e){var n=$(this),r=n.val();k=k.replace(r,""),k+=n.prop("checked")?r:"",t()}),$("#btnOutputToInput").click(function(e){h.setValue(p.val()),t()})}function t(){var e=s.val(),n=h.getValue(),t=f.val(),r=a(s,k),c="",i=[];if(0!=e.length&&0!=n.length){if(!(r instanceof RegExp))return o(!1);if(g===u.workMode.match){if(i=jch.jRegexTester.matchs(r,n),0==i.length)return o(!1);$.each(i,function(e,n){return!(n instanceof Array)||void(c+=n[0]+(e==i.length-1?"":u.getNewLineChar(v)))})}else g===u.workMode.replace&&(c=jch.jRegexTester.replace(r,n,t,m));o(c)}}function r(e){g=Number(e);var n=f.parents(".row");g===u.workMode.match?n.hide(0):g===u.workMode.replace&&n.show(0)}function a(e,n,t){void 0===n&&(n=""),void 0===t&&(t=".form-group");var r=e.val(),a=e.parents(t).eq(0),o=null;if(0==r.length)return o;try{o=new RegExp(r,n),a.removeClass("has-error")}catch(c){a.addClass("has-error")}return o}function o(e){var n=p.parents(".form-group").eq(0);"boolean"==typeof e&&e===!1?(p.val(""),n.addClass("has-error")):"string"==typeof e&&(p.val(e),n.removeClass("has-error"))}function c(){function e(e){return{line:n.substr(0,e).split("\n").length-1,ch:e-1-n.lastIndexOf("\n",e-1)}}var n=h.getValue();l=!0,b&&h.operation(function(){b.forEach(function(e){e.clear()})}),b=[];var t;try{var r=$("#tbReg").val();r&&(t=new RegExp(r,k))}catch(a){t=null}t&&n.search(t)!==-1&&h.operation(function(){var r,a=-1;for(t.index=0;null!==(r=t.exec(n));){var o=r[0].length,c=e(r.index),i=e(r.index+o),l=h.markText(c,i,"match-highlight");if(l.match=r,b.push(l),r.index===a)break;a=r.index}}),l=!1}function i(e){var n=h.findMarksAt(h.coordsChar({x:e.pageX,y:e.pageY}))[0];if(n!==x){var t=$("#match-tip");if(t.hide(),w&&(w.clear(),w=null),n){var r,a=n.match,o="index: "+a.index+"<br>length: "+a[0].length+"<br>";if(a.length>1){for(o+="groups:<br><blockquote><ol>",r=1;r<a.length;r++)o+="<li>"+a[r]+"</li>";o+="</ol></blockquote>"}var c=n.find(),i=h.charCoords(c.from),l=h.charCoords(c.to);w=h.markText(c.from,c.to,"focused"),t.html(o),t.css("left",i.x),t.css("top",l.yBot-170),t.show()}x=n}}var l,h=CodeMirror.fromTextArea(document.getElementById("tbInput"),{onChange:function(){h&&!l&&(t(),c())},styleActiveLine:!0,matchBrackets:!0,lineWrapping:!0,lineNumbers:!0,theme:"monokai",autofocus:!0}),u=jch.jRegexTester,s=$("#tbReg"),d=$("#tbInput"),f=$("#tbReplace"),p=$("#tbOutput"),g=u.workMode.match,m=u.replaceMode.includeNoMatch,v=u.newLineChar.CRLF,k="g";e();var b,x,w;$("#results-holder").mousemove(i),$("#match-tip").hide(),c()});