function style_html(t,i,e,n){function s(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed".split(","),extra_liners:"head,body,/html".split(","),in_array:function(t,i){for(var e=0;e<i.length;e++)if(t===i[e])return!0;return!1}},this.get_content=function(){for(var t="",i=[],e=!1;"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return i.length?i.join(""):["","TK_EOF"];if(t=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(t,this.Utils.whitespace))i.length&&(e=!0),this.line_char_count--;else{if(e){if(this.line_char_count>=this.max_char){i.push("\n");for(var n=0;n<this.indent_level;n++)i.push(this.indent_string);this.line_char_count=0}else i.push(" "),this.line_char_count++;e=!1}i.push(t)}}return i.length?i.join(""):""},this.get_script=function(){var t="",i=[],e=new RegExp("</script>","igm");e.lastIndex=this.pos;for(var n=e.exec(this.input),s=n?n.index:this.input.length;this.pos<s;){if(this.pos>=this.input.length)return i.length?i.join(""):["","TK_EOF"];t=this.input.charAt(this.pos),this.pos++,i.push(t)}return i.length?i.join(""):""},this.record_tag=function(t){this.tags[t+"count"]?(this.tags[t+"count"]++,this.tags[t+this.tags[t+"count"]]=this.indent_level):(this.tags[t+"count"]=1,this.tags[t+this.tags[t+"count"]]=this.indent_level),this.tags[t+this.tags[t+"count"]+"parent"]=this.tags.parent,this.tags.parent=t+this.tags[t+"count"]},this.retrieve_tag=function(t){if(this.tags[t+"count"]){for(var i=this.tags.parent;i&&t+this.tags[t+"count"]!==i;)i=this.tags[i+"parent"];i&&(this.indent_level=this.tags[t+this.tags[t+"count"]],this.tags.parent=this.tags[i+"parent"]),delete this.tags[t+this.tags[t+"count"]+"parent"],delete this.tags[t+this.tags[t+"count"]],1==this.tags[t+"count"]?delete this.tags[t+"count"]:this.tags[t+"count"]--}},this.get_tag=function(){var t="",i=[],e=!1;do{if(this.pos>=this.input.length)return i.length?i.join(""):["","TK_EOF"];t=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(t,this.Utils.whitespace)?(e=!0,this.line_char_count--):("'"!==t&&'"'!==t||i[1]&&"!"===i[1]||(t+=this.get_unformatted(t),e=!0),"="===t&&(e=!1),i.length&&"="!==i[i.length-1]&&">"!==t&&e&&(this.line_char_count>=this.max_char?(this.print_newline(!1,i),this.line_char_count=0):(i.push(" "),this.line_char_count++),e=!1),i.push(t))}while(">"!==t);var n,s=i.join("");n=s.indexOf(" ")!=-1?s.indexOf(" "):s.indexOf(">");var h=s.substring(1,n).toLowerCase();if("/"===s.charAt(s.length-2)||this.Utils.in_array(h,this.Utils.single_token))this.tag_type="SINGLE";else if("script"===h)this.record_tag(h),this.tag_type="SCRIPT";else if("style"===h)this.record_tag(h),this.tag_type="STYLE";else if("!"===h.charAt(0))if(h.indexOf("[if")!=-1){if(s.indexOf("!IE")!=-1){var r=this.get_unformatted("-->",s);i.push(r)}this.tag_type="START"}else if(h.indexOf("[endif")!=-1)this.tag_type="END",this.unindent();else if(h.indexOf("[cdata[")!=-1){var r=this.get_unformatted("]]>",s);i.push(r),this.tag_type="SINGLE"}else{var r=this.get_unformatted("-->",s);i.push(r),this.tag_type="SINGLE"}else"/"===h.charAt(0)?(this.retrieve_tag(h.substring(1)),this.tag_type="END"):(this.record_tag(h),this.tag_type="START"),this.Utils.in_array(h,this.Utils.extra_liners)&&this.print_newline(!0,this.output);return i.join("")},this.get_unformatted=function(t,i){if(i&&i.indexOf(t)!=-1)return"";var e="",n="",s=!0;do{if(e=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(e,this.Utils.whitespace)){if(!s){this.line_char_count--;continue}if("\n"===e||"\r"===e){n+="\n";for(var h=0;h<this.indent_level;h++)n+=this.indent_string;s=!1,this.line_char_count=0;continue}}n+=e,this.line_char_count++,s=!0}while(n.indexOf(t)==-1);return n},this.get_token=function(){var t;if("TK_TAG_SCRIPT"===this.last_token){var i=this.get_script();return"string"!=typeof i?i:(t=js_beautify(i,this.indent_size,this.indent_character,this.indent_level),[t,"TK_CONTENT"])}if("CONTENT"===this.current_mode)return t=this.get_content(),"string"!=typeof t?t:[t,"TK_CONTENT"];if("TAG"===this.current_mode){if(t=this.get_tag(),"string"!=typeof t)return t;var e="TK_TAG_"+this.tag_type;return[t,e]}},this.printer=function(t,i,e,n){this.input=t||"",this.output=[],this.indent_character=i||" ",this.indent_string="",this.indent_size=e||2,this.indent_level=0,this.max_char=n||70,this.line_char_count=0;for(var s=0;s<this.indent_size;s++)this.indent_string+=this.indent_character;this.print_newline=function(t,i){if(this.line_char_count=0,i&&i.length){if(!t)for(;this.Utils.in_array(i[i.length-1],this.Utils.whitespace);)i.pop();i.push("\n");for(var e=0;e<this.indent_level;e++)i.push(this.indent_string)}},this.print_token=function(t){this.output.push(t)},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var s,h;for(h=new s,h.printer(t,e,i);;){var r=h.get_token();if(h.token_text=r[0],h.token_type=r[1],"TK_EOF"===h.token_type)break;switch(h.token_type){case"TK_TAG_START":case"TK_TAG_SCRIPT":case"TK_TAG_STYLE":h.print_newline(!1,h.output),h.print_token(h.token_text),h.indent(),h.current_mode="CONTENT";break;case"TK_TAG_END":h.print_newline(!0,h.output),h.print_token(h.token_text),h.current_mode="CONTENT";break;case"TK_TAG_SINGLE":h.print_newline(!1,h.output),h.print_token(h.token_text),h.current_mode="CONTENT";break;case"TK_CONTENT":""!==h.token_text&&(h.print_newline(!1,h.output),h.print_token(h.token_text)),h.current_mode="TAG"}h.last_token=h.token_type,h.last_text=h.token_text}return h.output.join("")}