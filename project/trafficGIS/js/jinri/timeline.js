
var timelineData = [{"title":"简易事故 武汉长江二桥","image":"","context":" 2015年12月02日09时10分，姚红平(男，48岁，驾驶证号420982196703037811)驾驶车牌号为鄂K5T567的小型客车，沿武汉长江二桥行驶至武汉长江二桥时，与张勇(男，47岁)驾驶的车牌号为鄂AZW043的小型客车碰撞运动车辆，致直接财产损失3000元的交通事故。当事人姚红平负全部责任；当事人张勇无责任；","time":"09:10:00"},
    {"title":"简易事故 冶金大道 G","image":"","context":" 2015年12月02日09时10分，常新宇(男，52岁，驾驶证号413026196304166019)驾驶车牌号为鄂AQ6578的小型客车，沿冶金大道 G行驶至冶金大道 G时，与张本立(男，51岁)驾驶的车牌号为鄂A05385的小型客车碰撞运动车辆，致直接财产损失0元的交通事故。当事人常新宇负全部责任；当事人张本立无责任；","time":"09:10:00"},
    {"title":"简易事故 北华街北华街(古驿道路口)N00米","image":"","context":" 2015年12月02日09时00分，张攀(男，29岁，驾驶证号420115198608070096)驾驶车牌号为鄂A0ZP68的小型客车，沿北华街行驶至北华街北华街(古驿道路口)N00米时，与龚乾(男，28岁)驾驶的车牌号为鄂A0RU13的小型客车碰撞运动车辆，致直接财产损失1000元的交通事故。当事人张攀的行为违反了《中华人民共和国道路交通安全法》有关\"第二十二条第一款 机动车驾驶人应当遵守道路交通安全法律、法规的规定，按照操作规范安全驾驶、文明驾驶。\"之规定，负全部责任；当事人龚乾的行为违反了《中华人民共和国道路交通安全法》有关\"第二十二条第一款 机动车驾驶人应当遵守道路交通安全法律、法规的规定，按照操作规范安全驾驶、文明驾驶。\"之规定，无责任；","time":"09:03:00"},
    {"title":"简易事故 北华街北华街(古驿道路口)N00米","image":"","context":" 2015年12月02日09时00分，龚乾(男，28岁，驾驶证号420115198703230035)驾驶车牌号为鄂A0RU13的小型客车，沿北华街行驶至北华街北华街(古驿道路口)N00米时，与张攀(男，29岁)驾驶的车牌号为鄂A0ZP68的小型客车碰撞运动车辆，致直接财产损失1000元的交通事故。当事人龚乾的行为违反了《中华人民共和国道路交通安全法》有关\"第二十二条第一款 机动车驾驶人应当遵守道路交通安全法律、法规的规定，按照操作规范安全驾驶、文明驾驶。\"之规定，负全部责任；当事人张攀的行为违反了《中华人民共和国道路交通安全法》有关\"第二十二条第一款 机动车驾驶人应当遵守道路交通安全法律、法规的规定，按照操作规范安全驾驶、文明驾驶。\"之规定，无责任；","time":"09:00:00"},
    {"title":"简易事故 三环线","image":"","context":" 2015年12月02日09时00分，黎昕煜(女，30岁，驾驶证号432524198509180021)驾驶车牌号为鄂AA6626的中型客车，沿三环线行驶至三环线时，与敖明凯(男，26岁)驾驶的车牌号为鄂AJ83K3的小型客车碰撞运动车辆，致直接财产损失0元的交通事故。当事人黎昕煜负全部责任；当事人敖明凯无责任；","time":"09:00:00"},
    {"title":"简易事故 汉阳大道政府大院","image":"","context":" 2015年12月02日09时00分，古祥瑞(男，51岁，驾驶证号420105196406014211)驾驶车牌号为鄂A95LX1的小型客车，沿汉阳大道行驶至汉阳大道政府大院时，与周杰(男，37岁)驾驶的车牌号为鄂AE1M35的小型客车碰撞运动车辆，致直接财产损失0元的交通事故。当事人古祥瑞负全部责任；当事人周杰无责任；","time":"09:00:00"},
    {"title":"简易事故 茅店山中路茅店山中路(茅店山东路至茅店山西路100米","image":"","context":" 2015年12月02日09时00分，肖承勇(男，52岁，驾驶证号420106196309255212)驾驶车牌号为鄂AN32A8的小型客车，沿茅店山中路行驶至茅店山中路茅店山中路(茅店山东路至茅店山西路100米时，与致直接财产损失2000元的交通事故。当事人肖承勇负全部责任；","time":"09:00:00"},
    {"title":"简易事故 江达路路口","image":"","context":" 2015年12月02日08时50分，祝道惠(男，55岁)，骑电动自行车，沿江达路行驶至江达路路口时，与致直接财产损失1000元的交通事故。当事人祝道惠的行为违反了《中华人民共和国道路交通安全法》有关\"第二十二条第一款 机动车驾驶人应当遵守道路交通安全法律、法规的规定，按照操作规范安全驾驶、文明驾驶。\"之规定，负全部责任；","time":"08:50:00"},
    {"title":"简易事故 金墩街汉口站横路路口","image":"","context":" 2015年12月02日08时48分，毛伟驾驶车牌号为鄂AB3M32的小型客车，行驶至金墩街汉口站横路路口时，与陈亭忙骑电动自行车碰撞，致陈亭忙受伤、两车受损的交通事故。当事人毛伟负全部责任；当事人陈亭忙无责任；","time":"08:48:00"},
    {"title":"简易事故 宏志街（江夏大道至文华路）N江夏大道至文华路00米","image":"","context":" 2015年12月02日08时40分，李德明(男，37岁，驾驶证号420111197812155716)驾驶车牌号为鄂AF8C10的小型客车，沿宏志街（江夏大道至文华路）N行驶至宏志街（江夏大道至文华路）N江夏大道至文华路00米时，与李端华(男，40岁)驾驶的车牌号为鄂AH59F9的小型客车碰撞运动车辆，致直接财产损失1000元的交通事故。当事人李德明的行为违反了《中华人民共和国道路交通安全法》有关\"第二十二条第一款 机动车驾驶人应当遵守道路交通安全法律、法规的规定，按照操作规范安全驾驶、文明驾驶。\"之规定，负全部责任；当事人李端华的行为违反了《中华人民共和国道路交通安全法》有关\"第二十二条第一款 机动车驾驶人应当遵守道路交通安全法律、法规的规定，按照操作规范安全驾驶、文明驾驶。\"之规定，无责任；","time":"08:40:00"}]
$(document).ready(function () { // 动态加载数据
    refreshData(timelineData);
    upDateData();
    setInterval(upDateData,60*1000)
});

//请求分区数据
function upDateData(){
    //$.get('http://localhost:8080/TrafficSystem/servlet/Servlet_getSGAQ',function(data){
    //    timelineData = JSON.parse(data);
        refreshData(timelineData);
    //})
}

function refreshData(timelineData){
    var timelineContent = '';
    for(var i = 0; i < timelineData.length; i++){
        var data = timelineData[i];
        if(data.context.length > 150){
            data.context = data.context.slice(0,146);
            data.context += '...';
        }
        timelineContent += ('' +
            '<div class="oneTime">' +
            '            <div class="all">' +
            '                <div class="clocktime">' +
            '                    <div class="time">'+data.time+'</div>' +
            '                </div>' +
            '                <div class="clockline">' +
            '                    <div class="circle"></div>' +
            '                    <div class="line"></div>' +
            '                </div>' +
            '                <div class="jiantou">' +
            '                    <div class="bot"></div>' +
            '                    <div class="top"></div>' +
            '                </div>' +
            '                <div class="bubble">' +
            '                    <div class="test">' +
            '                        <div class="title">'+data.title+'</div>' +
//            '                        <div class="img"><img src="'+data.img+'"/></div>' +
            '                        <div class="content">'+data.context+'</div>' +
            '                    </div>' +
            '                </div>' +
            '            </div>' +
            '        </div>');
    }
    $('.tempTimeline').html(timelineContent);
    var contentArray = document.getElementsByClassName('all');
    for(var i = 0; i < contentArray.length; i++){
        var bubbleHeight = $('.bubble:eq('+i+')').height();
        $(contentArray[i]).height(bubbleHeight)
    }
    run();
}

$(document).ready(function () {// 根据气泡高度调整大小
	var contentArray = document.getElementsByClassName('all');
	for(var i = 0; i < contentArray.length; i++){
		var bubbleHeight = $('.bubble:eq('+i+')').height();
		$(contentArray[i]).height(bubbleHeight)
	}
});
var repeatTime = 0; // 滚动条重复次数
var fistScrollHeight = 0; // 第一次滚动到底部的高度
$(document).ready(function(){ // 滚动
    $('.tempTimeline').height($('#timeline').height() - 30);
    $(window).bind("resize", function(){
        $('.tempTimeline').height($('#timeline').height() - 30);
    });
	var currentHeight = $('#timeline').height();
	var timeLineHeight = 0;
	var contentArray = document.getElementsByClassName('all');
	for(var i = 0; i < contentArray.length; i++){
		timeLineHeight += $(contentArray[i]).height();
	}
	run();
});

function run() {
	setInterval(scroll, '70');
}
function scroll(){
	var obj =document.getElementsByClassName('tempTimeline')[0];
	var tmp = (obj.scrollTop)++;
	if (obj.scrollTop==tmp) {
		repeatTime++;
		if(repeatTime < 3) {
			fistScrollHeight  = obj.scrollTop;
			obj.innerHTML += obj.innerHTML;
		}else{
			obj.scrollTop = fistScrollHeight;
		}
	}
}
