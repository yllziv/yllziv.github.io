!function(){function e(e,n,i,r){if(this.atOccurrence=!1,this.doc=e,null==r&&"string"==typeof n&&(r=!1),i=i?e.clipPos(i):t(0,0),this.pos={from:i,to:i},"string"!=typeof n)n.global||(n=new RegExp(n.source,n.ignoreCase?"ig":"g")),this.matches=function(i,r){if(i){n.lastIndex=0;for(var o,s,h=e.getLine(r.line).slice(0,r.ch),c=0;;){n.lastIndex=c;var f=n.exec(h);if(!f)break;if(o=f,s=o.index,c=o.index+(o[0].length||1),c==h.length)break}var l=o&&o[0].length||0;l||(0==s&&0==h.length?o=void 0:s!=e.getLine(r.line).length&&l++)}else{n.lastIndex=r.ch;var h=e.getLine(r.line),o=n.exec(h),l=o&&o[0].length||0,s=o&&o.index;s+l==h.length||l||(l=1)}if(o&&l)return{from:t(r.line,s),to:t(r.line,s+l),match:o}};else{r&&(n=n.toLowerCase());var o=r?function(e){return e.toLowerCase()}:function(e){return e},s=n.split("\n");1==s.length?n.length?this.matches=function(i,r){var s,h=o(e.getLine(r.line)),c=n.length;if(i?r.ch>=c&&(s=h.lastIndexOf(n,r.ch-c))!=-1:(s=h.indexOf(n,r.ch))!=-1)return{from:t(r.line,s),to:t(r.line,s+c)}}:this.matches=function(){}:this.matches=function(n,i){var r=i.line,h=n?s.length-1:0,c=s[h],f=o(e.getLine(r)),l=n?f.indexOf(c)+c.length:f.lastIndexOf(c);if(!(n?l>=i.ch||l!=c.length:l<=i.ch||l!=f.length-c.length))for(;;){if(n?!r:r==e.lineCount()-1)return;if(f=o(e.getLine(r+=n?-1:1)),c=s[n?--h:++h],!(h>0&&h<s.length-1)){var u=n?f.lastIndexOf(c):f.indexOf(c)+c.length;if(n?u!=f.length-c.length:u!=c.length)return;var a=t(i.line,l),g=t(r,u);return{from:n?g:a,to:n?a:g}}if(f!=c)return}}}}var t=CodeMirror.Pos;e.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){function n(e){var n=t(e,0);return i.pos={from:n,to:n},i.atOccurrence=!1,!1}for(var i=this,r=this.doc.clipPos(e?this.pos.from:this.pos.to);;){if(this.pos=this.matches(e,r))return this.pos.from&&this.pos.to||console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(e){if(!r.line)return n(0);r=t(r.line-1,this.doc.getLine(r.line-1).length)}else{var o=this.doc.lineCount();if(r.line==o-1)return n(o);r=t(r.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e){if(this.atOccurrence){var n=CodeMirror.splitLines(e);this.doc.replaceRange(n,this.pos.from,this.pos.to),this.pos.to=t(this.pos.from.line+n.length-1,n[n.length-1].length+(1==n.length?this.pos.from.ch:0))}}},CodeMirror.defineExtension("getSearchCursor",function(t,n,i){return new e(this.doc,t,n,i)}),CodeMirror.defineDocExtension("getSearchCursor",function(t,n,i){return new e(this,t,n,i)})}();